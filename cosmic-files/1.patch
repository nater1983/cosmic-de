From 4a15af64d57f79a724c9f92036ecb44708b35f03 Mon Sep 17 00:00:00 2001
From: Ashley Wulber <ashley@system76.com>
Date: Fri, 2 May 2025 10:07:20 -0400
Subject: [PATCH 1/2] chore: update libcosmic

---
 Cargo.lock | 32 ++++++++++++++++----------------
 1 file changed, 16 insertions(+), 16 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index f8d4cd53..d46e95b6 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -1473,7 +1473,7 @@ dependencies = [
 [[package]]
 name = "cosmic-config"
 version = "0.1.0"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "atomicwrites",
  "cosmic-config-derive",
@@ -1495,7 +1495,7 @@ dependencies = [
 [[package]]
 name = "cosmic-config-derive"
 version = "0.1.0"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "quote",
  "syn 1.0.109",
@@ -1641,7 +1641,7 @@ dependencies = [
 [[package]]
 name = "cosmic-theme"
 version = "0.1.0"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "almost",
  "cosmic-config",
@@ -3081,7 +3081,7 @@ dependencies = [
  "js-sys",
  "log",
  "wasm-bindgen",
- "windows-core 0.61.0",
+ "windows-core 0.56.0",
 ]
 
 [[package]]
@@ -3096,7 +3096,7 @@ dependencies = [
 [[package]]
 name = "iced"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "dnd",
  "iced_accessibility",
@@ -3114,7 +3114,7 @@ dependencies = [
 [[package]]
 name = "iced_accessibility"
 version = "0.1.0"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "accesskit",
  "accesskit_winit",
@@ -3123,7 +3123,7 @@ dependencies = [
 [[package]]
 name = "iced_core"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "bitflags 2.9.0",
  "bytes",
@@ -3147,7 +3147,7 @@ dependencies = [
 [[package]]
 name = "iced_futures"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "futures",
  "iced_core",
@@ -3173,7 +3173,7 @@ dependencies = [
 [[package]]
 name = "iced_graphics"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "bitflags 2.9.0",
  "bytemuck",
@@ -3195,7 +3195,7 @@ dependencies = [
 [[package]]
 name = "iced_renderer"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "iced_graphics",
  "iced_tiny_skia",
@@ -3207,7 +3207,7 @@ dependencies = [
 [[package]]
 name = "iced_runtime"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "bytes",
  "cosmic-client-toolkit",
@@ -3222,7 +3222,7 @@ dependencies = [
 [[package]]
 name = "iced_tiny_skia"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "bytemuck",
  "cosmic-text",
@@ -3238,7 +3238,7 @@ dependencies = [
 [[package]]
 name = "iced_wgpu"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "as-raw-xcb-connection",
  "bitflags 2.9.0",
@@ -3269,7 +3269,7 @@ dependencies = [
 [[package]]
 name = "iced_widget"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "cosmic-client-toolkit",
  "dnd",
@@ -3287,7 +3287,7 @@ dependencies = [
 [[package]]
 name = "iced_winit"
 version = "0.14.0-dev"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "cosmic-client-toolkit",
  "dnd",
@@ -4147,7 +4147,7 @@ checksum = "d750af042f7ef4f724306de029d18836c26c1765a54a6a3f094cbd23a7267ffa"
 [[package]]
 name = "libcosmic"
 version = "0.1.0"
-source = "git+https://github.com/pop-os/libcosmic.git#e838616813470aa6a108ede07ab8e6050b68a5a6"
+source = "git+https://github.com/pop-os/libcosmic.git#7151638f519941d8439ad0ee05723c39ed561941"
 dependencies = [
  "apply",
  "ashpd 0.9.2",

From 74add23295549a55704645adacb25c82bdeb8ad1 Mon Sep 17 00:00:00 2001
From: Ashley Wulber <ashley@system76.com>
Date: Fri, 2 May 2025 12:13:24 -0400
Subject: [PATCH 2/2] revert 372cdf9

---
 Cargo.lock | 85 ++----------------------------------------------------
 Cargo.toml |  5 ----
 2 files changed, 2 insertions(+), 88 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index d46e95b6..f86d870b 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -711,29 +711,6 @@ dependencies = [
  "serde",
 ]
 
-[[package]]
-name = "bindgen"
-version = "0.69.5"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "271383c67ccabffb7381723dea0672a673f292304fcb45c01cc648c7a8d58088"
-dependencies = [
- "bitflags 2.9.0",
- "cexpr",
- "clang-sys",
- "itertools",
- "lazy_static",
- "lazycell",
- "log",
- "prettyplease",
- "proc-macro2",
- "quote",
- "regex",
- "rustc-hash 1.1.0",
- "shlex",
- "syn 2.0.101",
- "which",
-]
-
 [[package]]
 name = "bit-set"
 version = "0.6.0"
@@ -960,15 +937,6 @@ version = "1.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "6d43a04d8753f35258c91f8ec639f792891f748a1edbd759cf1dcea3382ad83c"
 
-[[package]]
-name = "cexpr"
-version = "0.6.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6fac387a98bb7c37292057cffc56d62ecb629900026402633ae9160df93a8766"
-dependencies = [
- "nom",
-]
-
 [[package]]
 name = "cfb"
 version = "0.7.3"
@@ -1043,17 +1011,6 @@ dependencies = [
  "inout",
 ]
 
-[[package]]
-name = "clang-sys"
-version = "1.8.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "0b023947811758c97c59bf9d1c188fd619ad4718dcaa767947df1cadb14f39f4"
-dependencies = [
- "glob",
- "libc",
- "libloading",
-]
-
 [[package]]
 name = "clipboard-win"
 version = "5.4.0"
@@ -1526,7 +1483,6 @@ dependencies = [
  "icu_provider",
  "ignore",
  "image",
- "io-uring",
  "libc",
  "libcosmic",
  "log",
@@ -2993,15 +2949,6 @@ dependencies = [
  "digest",
 ]
 
-[[package]]
-name = "home"
-version = "0.5.11"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "589533453244b0995c858700322199b2becb13b627df2851f64a2775d024abcf"
-dependencies = [
- "windows-sys 0.59.0",
-]
-
 [[package]]
 name = "i18n-config"
 version = "0.4.7"
@@ -3925,9 +3872,9 @@ dependencies = [
 [[package]]
 name = "io-uring"
 version = "0.7.4"
-source = "git+https://github.com/tokio-rs/io-uring.git?rev=2c9010a3316519e02444f41e536623099af58a84#2c9010a3316519e02444f41e536623099af58a84"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "ab01638bb6a279897b7691f87f3f3c232451711fd419a69ced980ce61074fa46"
 dependencies = [
- "bindgen",
  "bitflags 2.9.0",
  "cfg-if",
  "libc",
@@ -4126,12 +4073,6 @@ version = "1.5.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "bbd2bcb4c963f2ddae06a2efc7e9f3591312473c50c6685e1f298068316e66fe"
 
-[[package]]
-name = "lazycell"
-version = "1.3.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "830d08ce1d1d941e6b30645f1a0eb5643013d835ce3779a5fc208261dbe10f55"
-
 [[package]]
 name = "lebe"
 version = "0.5.2"
@@ -5496,16 +5437,6 @@ version = "0.3.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "e8cf8e6a8aa66ce33f63993ffc4ea4271eb5b0530a9002db8455ea6050c77bfa"
 
-[[package]]
-name = "prettyplease"
-version = "0.2.32"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "664ec5419c51e34154eec046ebcba56312d5a2fc3b09a06da188e1ad21afadf6"
-dependencies = [
- "proc-macro2",
- "syn 2.0.101",
-]
-
 [[package]]
 name = "proc-macro-crate"
 version = "1.3.1"
@@ -7735,18 +7666,6 @@ dependencies = [
  "web-sys",
 ]
 
-[[package]]
-name = "which"
-version = "4.4.2"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "87ba24419a2078cd2b0f2ede2691b6c66d8e47836da3b6db8265ebad47afbfc7"
-dependencies = [
- "either",
- "home",
- "once_cell",
- "rustix 0.38.44",
-]
-
 [[package]]
 name = "widestring"
 version = "1.2.0"
diff --git a/Cargo.toml b/Cargo.toml
index 267ecf10..98ac63a7 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -68,7 +68,6 @@ recently-used-xbel = "1.1.0"
 zip = "2.2.2"
 unix_permissions_ext = "0.1.2"
 uzers = "0.12.1"
-io-uring = { version = "0.7.4", features = ["bindgen"], optional = true }
 
 [dependencies.libcosmic]
 git = "https://github.com/pop-os/libcosmic.git"
@@ -82,7 +81,6 @@ default = [
     "dbus-config",
     "desktop",
     "gvfs",
-    "io-uring",
     "notify",
     "wgpu",
     "xz2",
@@ -118,9 +116,6 @@ tokio = { version = "1", features = ["rt", "macros"] }
 [patch.crates-io]
 # https://github.com/smol-rs/polling/pull/235
 polling = { git = "https://github.com/jackpot51/polling.git", branch = "master" }
-# Fixes building on ppc64le, s390x
-# https://github.com/tokio-rs/io-uring/issues/321#issuecomment-2831832546
-io-uring = { git = "https://github.com/tokio-rs/io-uring.git", rev = "2c9010a3316519e02444f41e536623099af58a84" }
 
 # [patch.'https://github.com/pop-os/cosmic-text']
 # cosmic-text = { path = "../cosmic-text" }
